(function(o,s){typeof exports=="object"&&typeof module<"u"?s(require("@fiftyone/plugins"),require("@fiftyone/utilities"),require("@fiftyone/state"),require("react"),require("recoil")):typeof define=="function"&&define.amd?define(["@fiftyone/plugins","@fiftyone/utilities","@fiftyone/state","react","recoil"],s):(o=typeof globalThis<"u"?globalThis:o||self,s(o.__fop__,o.__fou__,o.__fos__,o.React,o.recoil))})(this,function(o,s,d,n,c){"use strict";function a(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const r in e)if(r!=="default"){const u=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,u.get?u:{enumerable:!0,get:()=>e[r]})}}return t.default=e,Object.freeze(t)}const l=a(o),p=a(s),i=a(d);class m extends n.Component{state={hasError:!1};static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,r){console.error("Uncaught error rerun panel:",t,r)}render(){return this.state.hasError?n.createElement("h1",null,"Something went wrong."):this.props.children}}const _=9090,E=n.memo(({url:e})=>{const t=n.useMemo(()=>{if(new URL(window.location.href),typeof process<"u"){if(process.env?.PORT_RERUN)return parseInt(process.env.PORT_RERUN);if(process.env?.NEXT_PUBLIC_RERUN_PORT)return parseInt(process.env.NEXT_PUBLIC_PORT_RERUN)}return window.__ENV__?.PORT_RERUN?parseInt(window.__ENV__.PORT_RERUN):_},[]),r=n.useMemo(()=>`http://localhost:${t}/?url=${encodeURIComponent(e)}`,[e]);return n.createElement("iframe",{src:r,style:{width:"100%",height:"100%"}})}),f={EMBEDDED_DOC_TYPE:"fiftyone.utils.rerun.RrdFile"},h=n.memo(()=>{const e=c.useRecoilValue(i.modalSample),t=c.useRecoilValue(i.fieldSchema({space:i.State.SPACE.SAMPLE})),r=n.useMemo(()=>s.getFieldsWithEmbeddedDocType(t,f.EMBEDDED_DOC_TYPE).at(0)?.path,[t]),u=n.useMemo(()=>{if(!r||!e.urls)return;const P=e?.sample?.[r],R=i.getStandardizedUrls(e.urls)[`${r}.filepath`];return{url:i.getSampleSrc(R),version:P?.version}},[e,r]);return u?n.createElement(m,null,n.createElement(E,{url:u.url})):n.createElement("div",null,"Loading...")});l.registerComponent({name:"Rerun",label:"Rerun",component:h,activator:e=>p.doesSchemaContainEmbeddedDocType(e.schema,f.EMBEDDED_DOC_TYPE),type:l.PluginComponentType.Panel,panelOptions:{surfaces:"modal",helpMarkdown:"Rereun viewer for FiftyOne"}})});
